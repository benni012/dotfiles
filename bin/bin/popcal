#!/bin/bash
#
# dzen2 pop-up calendar
# (c) 2007, by Robert Manea
#
# Modified by tatou so it can be toggled when clicking on the panel.
#
# modified for my needs as well - arcetera

dzen_font="lime"
dzen_bg="#161719"
dzen_bg2="#161719"
dzen_fg="#c5c8c6"
dzen_sel="#3b3b41"
dzen_cmd="dzen2 -x 5 -y 30 -h 15 -tw 120 -w 120 -l"

# Close it if it's already opened
pgrep -f "$dzen_cmd" > /dev/null && pkill -f "$dzen_cmd" && exit

# Necessary info
TODAY=$(expr `date +'%d'` + 0)
MONTH=`date +'%m'`
YEAR=`date +'%Y'`
LINES=$(cal -m | wc -l)

# Create the popup
(date +'%A %d %B'
cal -m | sed -r -e "1,2 s/.*/^fg(#c5c8c6)&^fg()/"  -e "s/(^| )($TODAY)($| )/\1^bg($dzen_sel)^fg($dzen_fg)\2^fg()^bg()\3/") | $dzen_cmd $LINES -sa c -ta c -p -e 'onstart=uncollapse;button1=exit;button3=exit' -fn "$dzen_font" -fg "$dzen_fg" -bg "$dzen_bg2" & new_calendarpid=$!
